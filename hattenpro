<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>オセロ（リバーシ）</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 50px);
      grid-template-rows: repeat(8, 50px);
      margin: 20px auto;
      border: 2px solid #333;
    }
    .cell {
      width: 50px;
      height: 50px;
      background: #0a7d33;
      border: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .disk {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .black { background: black; }
    .white { background: white; border: 1px solid #333; }
    #info { margin-top: 10px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>オセロ（リバーシ）</h1>
  <div id="board"></div>
  <div id="info"></div>

  <script>
    const SIZE = 8;
    const EMPTY = ".";
    const BLACK = "B";
    const WHITE = "W";
    const board = [];
    let currentPlayer = BLACK;

    const directions = [
      [-1,-1],[-1,0],[-1,1],
      [0,-1],        [0,1],
      [1,-1],[1,0],[1,1]
    ];

    function initBoard() {
      for (let i=0;i<SIZE;i++) {
        board[i] = [];
        for (let j=0;j<SIZE;j++) board[i][j] = EMPTY;
      }
      board[3][3] = WHITE;
      board[4][4] = WHITE;
      board[3][4] = BLACK;
      board[4][3] = BLACK;
    }

    function drawBoard() {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      for (let x=0;x<SIZE;x++) {
        for (let y=0;y<SIZE;y++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.x = x;
          cell.dataset.y = y;
          if (board[x][y] === BLACK) {
            const disk = document.createElement("div");
            disk.className = "disk black";
            cell.appendChild(disk);
          } else if (board[x][y] === WHITE) {
            const disk = document.createElement("div");
            disk.className = "disk white";
            cell.appendChild(disk);
          }
          cell.onclick = () => handleClick(x,y);
          boardDiv.appendChild(cell);
        }
      }
      document.getElementById("info").textContent = 
        (currentPlayer===BLACK?"黒":"白") + " の番です";
    }

    function validMoves(player) {
      const moves = [];
      const opponent = (player===BLACK?WHITE:BLACK);
      for (let x=0;x<SIZE;x++) {
        for (let y=0;y<SIZE;y++) {
          if (board[x][y] !== EMPTY) continue;
          for (let [dx,dy] of directions) {
            let nx=x+dx, ny=y+dy;
            let found=false;
            while(nx>=0 && ny>=0 && nx<SIZE && ny<SIZE && board[nx][ny]===opponent){
              nx+=dx; ny+=dy; found=true;
            }
            if(found && nx>=0 && ny>=0 && nx<SIZE && ny<SIZE && board[nx][ny]===player){
              moves.push([x,y]);
              break;
            }
          }
        }
      }
      return moves;
    }

    function placeDisk(x,y,player){
      const opponent = (player===BLACK?WHITE:BLACK);
      board[x][y] = player;
      for (let [dx,dy] of directions){
        let nx=x+dx, ny=y+dy;
        const toFlip=[];
        while(nx>=0 && ny>=0 && nx<SIZE && ny<SIZE && board[nx][ny]===opponent){
          toFlip.push([nx,ny]);
          nx+=dx; ny+=dy;
        }
        if(toFlip.length && nx>=0 && ny>=0 && nx<SIZE && ny<SIZE && board[nx][ny]===player){
          for (let [fx,fy] of toFlip) board[fx][fy]=player;
        }
      }
    }

    function handleClick(x,y){
      const moves = validMoves(currentPlayer);
      if(!moves.some(m=>m[0]===x && m[1]===y)) return;
      placeDisk(x,y,currentPlayer);
      currentPlayer = (currentPlayer===BLACK?WHITE:BLACK);
      if(validMoves(currentPlayer).length===0){
        currentPlayer = (currentPlayer===BLACK?WHITE:BLACK);
        if(validMoves(currentPlayer).length===0){
          endGame();
          return;
        }
        alert("置ける場所がないのでパス！");
      }
      drawBoard();
    }

    function endGame(){
      let blackCount=0, whiteCount=0;
      for (let row of board){
        for (let cell of row){
          if(cell===BLACK) blackCount++;
          if(cell===WHITE) whiteCount++;
        }
      }
      let msg=`黒:${blackCount} 白:${whiteCount} → `;
      if(blackCount>whiteCount) msg+="黒の勝ち！";
      else if(whiteCount>blackCount) msg+="白の勝ち！";
      else msg+="引き分け！";
      document.getElementById("info").textContent = msg;
    }

    initBoard();
    drawBoard();
  </script>
</body>
</html>
